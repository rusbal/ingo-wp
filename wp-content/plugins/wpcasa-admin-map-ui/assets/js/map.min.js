!function(e){var o=[],t=function(t){function a(e,o){w.setPosition(e,CMBGmaps.zoom),setTimeout(function(){f.panTo(w.getPosition())},500),o&&f.setZoom(o),i.val(e.lat()),m.val(e.lng()),c.getElevationForLocations({locations:[w.getPosition()]},function(e,o){o==google.maps.ElevationStatus.OK&&e[0]&&r.val(e[0].elevation)})}function n(e){var o=new google.maps.LatLng(e.lat(),e.lng());geocoder=new google.maps.Geocoder,geocoder.geocode({latLng:o},function(e,o){o==google.maps.GeocoderStatus.OK&&p.val(e[0]?e[0].formatted_address:"invalid address")})}function s(e){"ROADMAP"==e&&f.setMapTypeId(google.maps.MapTypeId.ROADMAP),"SATELLITE"==e&&f.setMapTypeId(google.maps.MapTypeId.SATELLITE),"HYBRID"==e&&f.setMapTypeId(google.maps.MapTypeId.HYBRID),"TERRAIN"==e&&f.setMapTypeId(google.maps.MapTypeId.TERRAIN)}var p=e("#_map_address"),g=p.get(0),l=e(".map",t).get(0),i=e("._map_geolocation_lat",t),m=e("._map_geolocation_long",t),r=e("._map_geolocation_elevation",t),c=new google.maps.ElevationService,d=e('[name="_map_type"]'),v=e('[name="_map_zoom"]'),u=e('[name="_map_no_streetview"]'),_={center:new google.maps.LatLng(CMBGmaps.latitude,CMBGmaps.longitude),zoom:parseInt(CMBGmaps._map_zoom),scrollwheel:"true"==CMBGmaps.scrollwheel,streetViewControl:"on"!=CMBGmaps._map_no_streetview},f=new google.maps.Map(l,_);s(CMBGmaps._map_type);var M={map:f,draggable:!0,title:CMBGmaps.markerTitle},w=new google.maps.Marker(M);w.setPosition(_.center),i.val()&&m.val()&&(latLng=new google.maps.LatLng(i.val(),m.val()),a(latLng,parseInt(CMBGmaps._map_zoom))),window.google.maps.event.addListener(f,"click",function(e){a(e.latLng),n(e.latLng)}),window.google.maps.event.addListener(w,"dragend",function(){a(w.getPosition()),n(w.getPosition())});var L=new google.maps.places.Autocomplete(g);L.bindTo("bounds",f),google.maps.event.addListener(L,"place_changed",function(){var e=L.getPlace();a(e.geometry.location)}),e(g).keypress(function(e){13===e.keyCode&&e.preventDefault()}),d.change(function(){var e=d.filter(":checked").val();s(e)}),v.change(function(){var o=e("option:selected",this).val();f.setZoom(parseInt(o))}),u.change(function(){f.setOptions(e(this).is(":checked")?{streetViewControl:!1}:{streetViewControl:!0})}),o.push(f)};e(".cmb-type-map").each(function(){t(e(this))}),"undefined"!=typeof postboxes&&(postboxes.pbshow=function(){for(var e=o.length,t=0;e>t;t++){var a=o[t].getCenter();google.maps.event.trigger(o[t],"resize"),o[t].setCenter(a)}})}(jQuery);